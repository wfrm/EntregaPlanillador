<!doctype html>
<html>
<head>
<style>
.toggleWrapper{
	position: relative;
	top: 52%;
	right: -20%;
	overflow: hidden:
	-webkit-transform: translate3d(-50%, -50%, 0);
	transform: translate3d(-50%, -50%, 0);
}
.toggleWrapper input{
	position: relative;
	left: -99em;
}
.toggle{
	cursor: pointer;
	display: inline-block;
	position: relative;
	width: 120px;
	height: 50px;
	background: #3498DB;/*#d21626;*/
	border-radius: 5px;
	-webkit-transition: all 200ms cubic-bezier(0.445, 0.05, 0.55, 0.95);
	transition: all 200ms cubic-bezier(0.445, 0.05, 0.55, 0.95);
}
.toggle:before, .toggle:after{
	position: absolute;
	line-height: 50px;
	font-size: 14px;
	z-index: 2;
	-webkit-transition: all 200ms cubic-bezier(0.445, 0.05, 0.55, 0.95);
	transition: all 200ms cubic-bezier(0.445, 0.05, 0.55, 0.95);
}
.toggle:before{
	content: "OFF";
	left: 20px;
	color: #D21626;
}
.toggle:after{
	content: "ON";
	right: 20px;
	color: #fff;
}
.toggle__handler{
	display: inline-block;
	position: relative;
	z-index: 1;
	background: #fff;
	width: 65px;
	height: 44px;
	border-radius: 3px;
	top: 3px;
	left: 3px;
	-webkit-transition: all 200ms cubic-bezier(0.445, 0.05, 0.55, 0.95);
	transition: all 200ms cubic-bezier(0.445, 0.05, 0.55, 0.95);
	-webkit-transform: translateX(0px);
	transform: translateX(0px);
}
input:checked + .toggle{
	background: #555;/*#66b317;*/
}
input:checked + .toggle:before{
	color: #fff;
}
input:checked + .toggle:after{
	color: #66b317;
}
input:checked + .toggle .toggle__handler{
	width: 54px;
	-webkit-transform: translateX(60px);
	transform: translateX(60px);
	border-color: #fff;
}
</style>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>planilla</title>
<link rel="stylesheet" type="text/css" href="style.css">
<link rel="stylesheet" type="text/css" href="style2.css">
<link rel="stylesheet" type="text/css" href="style3.css">
<link rel="stylesheet" href="dist/wickedpicker.min.css">
</head>
<body>
<center><h2>Programación de dispositivos</h2></center>
<div class="wraper">
	<div class="botonera"><!-- botonera -->
		<div class="btn">
			<button id="borrado" onclick="borrando()"><img src="borrar.jpg"></button>
			<button id="registrar" onclick="json()"><img src="registrar.jpg"></button>
			<button id="lecturaMemoria" onclick="leerjson()"><img src="leer.jpg"></button>
			<div class="toggleWrapper">
				<input type="checkbox" id="dn" class="dn" onclick="guardarLaHora()">
				<label for="dn" class="toggle"><span class="toggle__handler"></span></label>
			</div>
		</div>

		<div>
			<button type="button" class="collapsible">Programacion rapida</button>
			<div class="content">
				<div class="btn">
					<img src="dia.png">
					<button class="button" onclick="dia(1)">Día</button>
				</div>
				<div class="btn">
					<img src="noche.png">
					<button class="button" onclick="dia(2)">Noche</button>
				</div>
				<div class="btn">
					<img src="madrugada.png">
					<button class="button" onclick="dia(3)">Madrugada</button>
				</div>
				<div class="btn">
					<img src="finSemana.png">
					<button class="button" onclick="dia(4)">Fin semana</button>
				</div>
				<div class="btn">
					<img src="ordinario.png">
					<button class="button" onclick="dia(5)">Oridinal</button>
				</div>
				<div class="btn">
					<img src="festivo.jpg">
					<button class="button" onclick="dia(6)">Festivo</button>
				</div>

			</div>
			<button type="button" class="collapsible">Programacion personalizada</button>
			<div class="content">
				<div class="btn">
					<img src="porUsuario.png">
					<button class="button" onclick="dia(7)">Personalizado 1</button>
				</div>
				<div class="btn">
					<img src="porUsuario.png">
					<button class="button" onclick="dia(8)">Personalizado 2</button>
				</div>


				<div class="content__subsection picker-container">
					<h4>Encendido:</h4>
					<input type="text" id="inicio" name="timepicker-12-hr_1" class="timepicker-12-hr">
				</div>
					&nbsp &nbsp &nbsp
				<div class="content__subsection picker-container">
					<h4>Apagado:</h4>
					<input type="text" id="fin" name="timepicker-12-hr_2" class="timepicker-12-hr">
				</div>

				
			</div>
			
		</div>

	</div><!-- fin botonera -->
	<div class="grilla"><!-- grilla -->
		<div class="dispositivo"> 
			<div>seleccion dispositivo</div>
			<button class="button1" onclick="seleccionDisp(1)" id="dispositivo1">1</button>
			<button class="button1" onclick="seleccionDisp(2)" id="dispositivo2">2</button>
			<button class="button1" onclick="seleccionDisp(3)" id="dispositivo3">3</button>
			<button class="button1" onclick="seleccionDisp(4)" id="dispositivo4">4</button>
			<button class="button1" onclick="seleccionDisp(5)" id="dispositivo5">5</button>
			<button class="button1" onclick="seleccionDisp(6)" id="dispositivo6">6</button>
			<button class="button1" onclick="seleccionDisp(7)" id="dispositivo7">7</button>
			<button class="button1" onclick="seleccionDisp(8)" id="dispositivo8">8</button>
			<button class="button1" onclick="seleccionDisp(9)" id="dispositivo9">9</button>
			<button class="button1" onclick="seleccionDisp(10)" id="dispositivo10">10</button>
		</div>
		<div class="diaSemana">
			<div>seleccion dia</div>
			<button class="button1" onclick="seleccionDia(0)" id="dia0">Domingo</button>
			<button class="button1" onclick="seleccionDia(1)" id="dia1">Lunes</button>
			<button class="button1" onclick="seleccionDia(2)" id="dia2">Martes</button>
			<button class="button1" onclick="seleccionDia(3)" id="dia3">Miercoles</button>
			<button class="button1" onclick="seleccionDia(4)" id="dia4">Jueves</button>
			<button class="button1" onclick="seleccionDia(5)" id="dia5">Viernes</button>
			<button class="button1" onclick="seleccionDia(6)" id="dia6">Sabado</button>
		</div>
		<div class="ex1" id="scroll">
			<div id="day-schedule"></div>
		</div>
	</div><!--fin  grilla -->
</div>





<!-- BORRAR DE AQUI EN ADELANTE -->
<div class="jquery-script-clear"></div>
<!--
<h1 style="margin:30px auto 30px auto;">horario de operacion</h1>
<p> LED Status: <span id="led-state">__</span> </p> -->
<p id="display-time"></p>


<script src="jquery-1.11.2.js"></script>
<script src="index.js"></script>
<!-- variables globales ----------------------------------------->
<script>
var weekday = new Array(7);
weekday[0] = "Domingo";
weekday[1] = "Lunes";
weekday[2] = "Martes";
weekday[3] = "Miercoles";
weekday[4] = "Jueves";
weekday[5] = "viernes";
weekday[6] = "Sabado";
var hoy="";
var horas=[];

var activador={0: Array(0), 1: Array(0), 2: Array(0), 3: Array(0), 4: Array(0), 5: Array(0), 6: Array(0)};
var horaInicio;
var horaFin;
var seleccion=[];
var xhr = new XMLHttpRequest();
//var base="http://192.168.1.85/";
var base="http://"+location.host+"/";
var url;
var resultado;
var ll=0;
var now;
var ss=0;
var dis;
var longi=window.innerHeight;
var max=80;
var cambio;
var diaSemana;
var loopScan=false;

///////////////////////////////// horarios predefinidos //////////////////////////////
var horaInicioDia="07:30";
var horaFinDia="18:30";

var horaInicioNoche="17:00";
var horaFinNoche="24:00";

var horaInicioMadrugada1="22:00";
var horaFinMadrugada1="24:00";

var horaInicioMadrugada2="00:00";
var horaFinMadrugada2="07:30";

var horaInicioFinSemana="06:00";
var horaFinFinSemana="12:00";

var horaInicioOrdinario="07:30";
var horaFinOrdinario="18:30";

var horaInicioFestivo="06:00";
var horaFinFestivo="12:00";

var horaInicioUsuario1="00:00";
var horaFinUsuario1="07:30";

var horaInicioUsuario2="00:00";
var horaFinUsuario2="07:30";

var guardarHora=0;


var diaOpcion=0;
/////////////////////////////////////////////////////////////////////////////////////

var indD=0;
var dispositivos = ["dispositivo1", "dispositivo2", "dispositivo3", "dispositivo4", "dispositivo5", "dispositivo6"];
</script>
<!--------------------------------------------------------------->
<script>
function seleccionDia(d)
{
console.log(d);
diaSemana=d;
diaelegido="dia"+diaSemana;
document.getElementById("dia0").style.background = '#3498DB'
document.getElementById("dia1").style.background = '#3498DB'
document.getElementById("dia2").style.background = '#3498DB'
document.getElementById("dia3").style.background = '#3498DB'
document.getElementById("dia4").style.background = '#3498DB'
document.getElementById("dia5").style.background = '#3498DB'
document.getElementById("dia6").style.background = '#3498DB'

document.getElementById(diaelegido).style.background = '#555'

}

function seleccionDisp(disp)
{
console.log(disp);
dis=disp;
dispelegido="dispositivo"+disp;
document.getElementById("dispositivo1").style.background = '#3498DB';
document.getElementById("dispositivo2").style.background = '#3498DB';
document.getElementById("dispositivo3").style.background = '#3498DB';
document.getElementById("dispositivo4").style.background = '#3498DB';
document.getElementById("dispositivo5").style.background = '#3498DB';
document.getElementById("dispositivo6").style.background = '#3498DB';
document.getElementById("dispositivo7").style.background = '#3498DB';
document.getElementById("dispositivo8").style.background = '#3498DB';
document.getElementById("dispositivo9").style.background = '#3498DB';
document.getElementById("dispositivo10").style.background = '#3498DB';
document.getElementById(dispelegido).style.background = '#555';
borrar();

}

</script>


  <script>
  //funcion de colapsible
var coll = document.getElementsByClassName("collapsible");
var i;

for (i = 0; i < coll.length; i++) {
  coll[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var content = this.nextElementSibling;
    if (content.style.display === "block") {
      content.style.display = "none";
    } else {
      content.style.display = "block";
    }
  });
}
</script>


<script>
(function ($) {
      $("#day-schedule").dayScheduleSelector({
	  interval: 1,
	  startTime: '00:00',
	  endTime: '24:00'
      });
      $("#day-schedule").on('selected.artsy.dayScheduleSelector', function (e, selected) {
        var sel=selected;

                       
      })
    })($);

</script>

<!-- respuesta sincronizada ------------------>
<script>
	xhr.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) 
	{
		//document.getElementById("led-state").innerHTML = this.responseText;
		console.log(this.responseText);
		if(ll==2)
		{
			
			rtjson='{'+this.responseText+'}';
			rtjson=JSON.parse(rtjson);
			console.log(rtjson);
			$("#day-schedule").data('artsy.dayScheduleSelector').deserialize(rtjson);
			ll=0;
			activador=rtjson;
			consultaPin(dis);
		}
		if(ll==1)// rellenar cuadricula con lectura de la memporia
		{	
			
			var res = this.responseText.split(",");
			var t=[];
			b=document.querySelectorAll('[data-day="0"]');//no importa el dia, es para obtener el listado de las horas

			for (j=0;j<7;j++)
			{
				ini=0;
				var tt=[];
				for (var i = 0; i < res[j].length; i++) {
					if(res[j][i]=='1' && ini==0)
					{
						ini=1;
						Hinicio=b[i].getAttribute("data-time");//obtendo la hora de cualquier dia
						//t.push(b[i].getAttribute("data-time"));
					}
					if(res[j][i]=='0' && ini==1)
					{
						ini=0;
						Hfinal=b[i].getAttribute("data-time");
						tt.push([Hinicio,Hfinal]);
					}
					if(i==res[j].length-1 && ini==1)
					{
						Hfinal='24:00';
						tt.push([Hinicio,Hfinal]);
						ini=0;
					}
				}
			//tt.push(t);
			t.push(tt);
			}
			activador={'0':t[0],'1':t[1],'2':t[2],'3':t[3],'4':t[4],'5':t[5],'6':t[6]};
			console.log(`leido activador: ${dis}`);
			console.log(activador);
			$("#day-schedule").data('artsy.dayScheduleSelector').deserialize(activador);
			ll=0;
		}
		if((ll ==0 && ss==1))
		{
		ss=0;
		if(activador[now.getDay()].length>0)
			{
			hhh=activador[now.getDay()][0][0].split(":");
			hini=parseInt(hhh[0])*100+parseInt(hhh[1]);

			hhh=activador[now.getDay()][0][1].split(":");
			hfin=parseInt(hhh[0])*100+parseInt(hhh[1]);

			vv=now.getHours()*100+now.getMinutes();

			var aa=0;
			hoy="[data-day=\""+now.getDay()+"\"]";

						if(vv>=hini && vv<=hfin)
						{
							console.log(dis +" hora de activacion: "+vv);
							activar(dis,1);

						}
						else
						{
							console.log("apagar "+ dis);
							activar(dis,0);
						}



			}
			else
			{
				console.log("apagar "+ dis);
				activar(dis,0);
			}

	}

    }
  };
</script>
<!---------------------------------------------->


<script>
function leerjson()
{

ll=2;
//dis=$("#dispositivo option:selected").val();
$("#day-schedule").data('artsy.dayScheduleSelector').clear();
url = base+"loadJson?dispositivo="+"dispositivo"+dis;
xhr.open("GET", url, true);
xhr.send();
};
</script>


<script>
function leeme()
{
ll=1;
//dis=$("#dispositivo option:selected").val();
$("#day-schedule").data('artsy.dayScheduleSelector').clear();
console.log("leer json!");
url = base+"loadJson?dispositivo="+"dispositivo"+dis;
xhr.open("GET", url, true);
xhr.send();
};
</script>

<script>
function consultaPin(aparato)
{
if(aparato=="dispositivo1")
	url = base+"consulta?pin=16";
else if (aparato=="dispositivo2")
	url = base+"consulta?pin=14";
else if (aparato=="dispositivo3")
	url = base+"consulta?pin=12";
else if (aparato=="dispositivo4")
	url = base+"consulta?pin=13";
else if (aparato=="dispositivo5")
	url = base+"consulta?pin=15";
else if (aparato=="dispositivo6")
	url = base+"consulta?pin=2";
console.log(url);
xhr.open("GET", url, true);
xhr.send();
};
function activar(aparato,e)
{
//console.log(`aparato: ${aparato}`);
//console.log(`estado: ${e}`);

if(aparato=="dispositivo1")
	url = base+"salidas?estado="+e+"&pin=16";
else if (aparato=="dispositivo2")
	url = base+"salidas?estado="+e+"&pin=14";
else if (aparato=="dispositivo3")
	url = base+"salidas?estado="+e+"&pin=12";
else if (aparato=="dispositivo4")
	url = base+"salidas?estado="+e+"&pin=13";
else if (aparato=="dispositivo5")
	url = base+"salidas?estado="+e+"&pin=15";
else if (aparato=="dispositivo6")
	url = base+"salidas?estado="+e+"&pin=2";
console.log(url);
xhr.open("GET", url, true);
xhr.send();
};
</script>


<!-- escaneo de la planilla -------------------->
<script>

function scan()
{
	
	now = new Date();
	//document.getElementById("display-time").innerHTML =now;
	//document.getElementById('dispositivo').value=dispositivos[indD];
	ss=1;
	leerjson();
	
	
	indD=indD+1;
	if(indD>5)
	indD=0;

	
}scan();

</script>

<!--------------------------------------------------->




<script>
function borrar() {
	$("#day-schedule").data('artsy.dayScheduleSelector').clear();
	//dis=document.getElementById("dispositivo").value;
	//document.getElementsByTagName("dispo")[0].innerHTML =dis;
	console.log(dis);
	leerjson();//tener encuenta cuando no se este haciendo scan
};

function borrando() {
	$("#day-schedule").data('artsy.dayScheduleSelector').clear();
};
</script>


<script>
function conmutable()
{
if(loopScan)
{
prender();
loopScan=false;
}
else
{
apagar();
loopScan=true;
}
}
function prender()
{
timer=setInterval(scan, 1000);
};
function apagar()
{
clearInterval(timer);
};
//document.addEventListener('DOMContentLoaded', prender, false);
</script>

<script>
function grabar() {
 //var dis=$("#dispositivo option:selected").val();
 domingo="";
  b=document.querySelectorAll('[data-day="0"]');
  b.forEach(function(element) {element.attributes.length>3?domingo=domingo+"1":domingo=domingo+"0";})
  //console.log(domingo);
   lunes="";
  b=document.querySelectorAll('[data-day="1"]');
  b.forEach(function(element) {element.attributes.length>3?lunes=lunes+"1":lunes=lunes+"0";})
  //console.log(lunes);
     martes="";
  b=document.querySelectorAll('[data-day="2"]');
  b.forEach(function(element) {element.attributes.length>3?martes=martes+"1":martes=martes+"0";})
  //console.log(martes);
     miercoles="";
  b=document.querySelectorAll('[data-day="3"]');
  b.forEach(function(element) {element.attributes.length>3?miercoles=miercoles+"1":miercoles=miercoles+"0";})
  //console.log(miercoles);
     jueves="";
  b=document.querySelectorAll('[data-day="4"]');
  b.forEach(function(element) {element.attributes.length>3?jueves=jueves+"1":jueves=jueves+"0";})
  //console.log(jueves);
     viernes="";
  b=document.querySelectorAll('[data-day="5"]');
  b.forEach(function(element) {element.attributes.length>3?viernes=viernes+"1":viernes=viernes+"0";})
  //console.log(viernes);
     sabado="";
  b=document.querySelectorAll('[data-day="6"]');
  b.forEach(function(element) {element.attributes.length>3?sabado=sabado+"1":sabado=sabado+"0";})
  //console.log(sabado);
  resultado=domingo+","+lunes+","+martes+","+miercoles+","+jueves+","+viernes+","+sabado+"dispositivo"+dis;
  //document.getElementById("led-state").innerHTML =resultado;
  console.log(resultado);
  url=base+"saveJson?semana="+resultado;
  xhr.open("GET", url, true);
  xhr.send();
}
</script>

<script>
window.onload = function() {
now = new Date();
console.log(`cargado en ${now}`);
x=document.getElementById("scroll");
h=now.getHours()+now.getMinutes()/60;
max=x.scrollHeight;
x.scroll(0,h*max/24);
diaSemana=now.getDay();
seleccionDia(now.getDay());
seleccionDisp(1);

//timer=setInterval(scan, 1000);
};
</script>

<!-- Timepicker Js -->
<script src="dist/wickedpicker.min.js"></script>
<script>
antes=function(e,timepicker)
{
	ff=this;
	console.log(e.context.id);
	cambio=e.context.id;
};

</script>
<script>
despues=function(e,timepicker)
{

	Sdespues=timepicker[0].outerText;
	Sdespues=Sdespues.split(".")[1];
	Sdespues=Sdespues.split("null")[0];
	if(cambio=="inicio")
	{
		horaInicio=Sdespues;
	}
	if(cambio=="fin")
	{
		horaFin=Sdespues;
		seleccion.push([horaInicio]);
		seleccion.push([horaFin]);
	}
	console.log(seleccion);
	//diaSemana=$('.diaSemana:checked').val();// ya no habria chekbox
	if(guardarHora==0)
	{
		if(diaSemana=="0")
			$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"0": [seleccion]});
		if(diaSemana=="1")
			$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"1": [seleccion]});
		if(diaSemana=="2")
			$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"2": [seleccion]});
		if(diaSemana=="3")
			$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"3": [seleccion]});
		if(diaSemana=="4")
			$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"4": [seleccion]});
		if(diaSemana=="5")
			$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"5": [seleccion]});
		if(diaSemana=="6")
			$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"6": [seleccion]});
		seleccion=[];
	}
	else if(guardarHora==1)	
	{
		if(diaOpcion==1)// ajustar horario dia
		{
			horaInicioDia=horaInicio;
			horaFinDia=horaFin;
			console.log(`horario ajustado: inicio= ${horaInicio} hasta ${horaFin}`);

		}
		else if(diaOpcion==2)//ajustar horario noche
		{
			horaInicioNoche=horaInicio;
			horaFinNoche=horaFin;
			console.log(`horario ajustado: inicio= ${horaInicio} hasta ${horaFin}`);

		}
		else if(diaOpcion==3)//ajustar horario madrugada
		{
			horaInicioMadrugada1=horaInicio;
			horaFinMadrugada1="24 : 00";
			horaInicioMadrugada2="00 : 00";
			horaFinMadrugada2=horaFin;
			console.log(`horario ajustado: inicio= ${horaInicio} hasta ${horaFin}`);
		}
		else if(diaOpcion==4)//ajustar horario fin de semana
		{
			horaInicioFinSemana=horaInicio;
			horaFinFinSemana=horaFin;
			console.log(`horario ajustado: inicio= ${horaInicio} hasta ${horaFin}`);
		}
		else if(diaOpcion==5)//ajustar horario ordinario
		{

			horaInicioOrdinario=horaInicio;
			horaFinOrdinario=horaFin;
			console.log(`horario ajustado: inicio= ${horaInicio} hasta ${horaFin}`);

		}
		else if(diaOpcion==6)//ajustar horario festivo
		{

			horaInicioFestivo=horaInicio;
			horaFinFestivo=horaFin;
			console.log(`horario ajustado: inicio= ${horaInicio} hasta ${horaFin}`);
		}
		else if(diaOpcion==7)// ajustar horario usuario1
		{
			 horaInicioUsuario1=horaInicio;
			 horaFinUsuario1=horaFin;
			 console.log(`horario ajustado: inicio= ${horaInicio} hasta ${horaFin}`);

		}
		else if(diaOpcion==8)//ajustar horario usuario2
		{
			 horaInicioUsuario2=horaInicio;
			 horaFinUsuario2=horaFin;
			 console.log(`horario ajustado: inicio= ${horaInicio} hasta ${horaFin}`);
		}
		else
		{
				console.log("no ha seleccionado un modo de programacion");
		}
	}
};
</script>

<script>
  var twelveHour = $('.timepicker-12-hr').wickedpicker(
	{ 	
		twentyFour: true,
		title: 'cambiar hora.',
		beforeShow: antes,
		afterShow: despues
	});
            $('.time').text('//JS Console: ' + twelveHour.wickedpicker('time'));
            $('.timepicker-24-hr').wickedpicker({twentyFour: true});
            $('.timepicker-12-hr-clearable').wickedpicker({clearable: true});
</script>

<script>
// the selector will match all input controls of type :checkbox
// and attach a click event handler 
$("input:checkbox").on('click', function() {
  // in the handler, 'this' refers to the box clicked on
  var $box = $(this);
  if ($box.is(":checked")) {
    // the name of the box is retrieved using the .attr() method
    // as it is assumed and expected to be immutable
    var group = "input:checkbox[name='" + $box.attr("name") + "']";
    // the checked state of the group/box on the other hand will change
    // and the current value is retrieved using .prop() method
    $(group).prop("checked", false);
    $box.prop("checked", true);
  } else {
    $box.prop("checked", false);
  }
});
</script>

<script>
function json(dispo)
{
ll=0;
 //var dis=$("#dispositivo option:selected").val();// version css2
jsonDia=[];
	for(jsonj=0;jsonj<7;jsonj++)
	{
		hoySeleccion="[data-day=\""+jsonj+"\"]"+"[data-selected=\"selected\"]";

		a=document.querySelectorAll(hoySeleccion);

		jsActivador=[];
		selectos=[];
		a.forEach(element => {
			selectos.push(element.dataset.time);
		});
		selectosHf=[];
		selectos.forEach(element=>{
			jshora=element.split(":");
			hshh=jshora[0];
			hsmm=parseInt(jshora[1])+1;
			if(hsmm>59)
			{
				sss=parseInt(hshh)+1;
				hshh=sss.toString();
				if(hshh<10 || hshh=="00")
				{
					if(hshh=="00")
					hshh=hshh.toString();
					else
					hshh="0"+hshh.toString();
				}
				hsmm="00";
			}
			if(hsmm<10 || hsmm =="00")
			{
			if(hsmm =="00")
			hsmm=hsmm.toString();
			else
			hsmm="0"+hsmm.toString();
			}
			jshf=hshh+":"+hsmm.toString();
			//console.log(`tiempo final ${jshf}`);
			selectosHf.push(jshf);

		});
		var jsi;
		jsinit=0;
		var jshinicial=selectos[0];
		var jshfinal=selectosHf[0];
		for (jsi = 0; jsi < selectos.length; jsi++)
		{
			if(jsinit==0)
			{
			
				jshinicial=selectos[jsi];
				jshfinal=selectosHf[jsi];
				jsinit=1;
			}


			  if(jshfinal==selectos[jsi+1] && jsi+1<selectos.length)
			{
				jshfinal=selectosHf[jsi+1];
			}
			else
			{
				jsActivador.push([jshinicial,jshfinal]);
				jsinit=0;
			}

		}
		console.log(jsActivador);
		
		jsonDia.push(jsActivador);
	}
	jsonactivador={'0':jsonDia[0],'1':jsonDia[1],'2':jsonDia[2],'3':jsonDia[3],'4':jsonDia[4],'5':jsonDia[5],'6':jsonDia[6]};
	resultado=JSON.stringify(jsonactivador);

	$("#day-schedule").data('artsy.dayScheduleSelector').clear();
	$("#day-schedule").data('artsy.dayScheduleSelector').deserialize(jsonactivador);
	url=base+"saveJson?semana="+resultado+'dispositivo:'+"dispositivo"+dis+'#';
	console.log(url);
	xhr.open("GET", url, true);
	xhr.send();

}
</script>

<script>
function dia(p)
{
diaOpcion=p;
//$("#day-schedule").data('artsy.dayScheduleSelector').clear();
//diaSemana=$('.diaSemana:checked').val();//ya no habria checkbox
seleccion=[];
if(p==1)
{
document.getElementById("inicio").value=horaInicioDia;
document.getElementById("fin").value=horaFinDia;
horaInicio=horaInicioDia;
horaFin=horaFinDia;
}
if(p==2)
{
document.getElementById("inicio").value=horaInicioNoche;
document.getElementById("fin").value=horaFinNoche;
horaInicio=horaInicioNoche;
horaFin=horaFinNoche;
}
if(p==3)
{
document.getElementById("inicio").value=horaInicioMadrugada1;
document.getElementById("fin").value="07:30";
horaInicio= horaInicioMadrugada1;
horaFin="24:00";
seleccion.push([horaInicio]);
seleccion.push([horaFin]);
if(diaSemana=="0")
	$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"0": [seleccion]});
		if(diaSemana=="1")
	$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"1": [seleccion]});
		if(diaSemana=="2")
	$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"2": [seleccion]});
		if(diaSemana=="3")
	$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"3": [seleccion]});
		if(diaSemana=="4")
	$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"4": [seleccion]});
		if(diaSemana=="5")
	$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"5": [seleccion]});
		if(diaSemana=="6")
	$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"6": [seleccion]});
	seleccion=[];
horaInicio="00:00";
horaFin= horaFinMadrugada2;
}
if(p==4 )
{
document.getElementById("inicio").value=horaInicioFinSemana;
document.getElementById("fin").value=horaFinFinSemana;
horaInicio=horaInicioFinSemana;
horaFin=horaFinFinSemana;
seleccion.push([horaInicio]);
seleccion.push([horaFin]);
console.log(seleccion);
$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"6": [seleccion]});//finde semana = sabado
//$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"0": [seleccion]});// habilitar si fin de semana es domingo
}
if(p==5 )
{
document.getElementById("inicio").value= horaInicioOrdinario;
document.getElementById("fin").value=horaFinOrdinario;
horaInicio=horaInicioOrdinario;
horaFin=horaFinOrdinario;

}
if(p==6 )
{
document.getElementById("inicio").value=horaInicioFestivo;
document.getElementById("fin").value=horaFinFestivo;
horaInicio=horaInicioFestivo;
horaFin=horaFinFestivo;

}
if(p==7 )
{
document.getElementById("inicio").value=horaInicioUsuario1;
document.getElementById("fin").value=horaFinUsuario1;
horaInicio=horaInicioUsuario1;
horaFin=horaFinUsuario1;

}
if(p==8 )
{
document.getElementById("inicio").value=horaInicioUsuario2;
document.getElementById("fin").value=horaFinUsuario2;
horaInicio=horaInicioUsuario2;
horaFin=horaFinUsuario2;

}
if(p!=4 )
{
seleccion.push(horaInicio,horaFin);
console.log(seleccion);
	if(diaSemana=="0")
	$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"0": [seleccion]});
		if(diaSemana=="1")
	$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"1": [seleccion]});
		if(diaSemana=="2")
	$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"2": [seleccion]});
		if(diaSemana=="3")
	$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"3": [seleccion]});
		if(diaSemana=="4")
	$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"4": [seleccion]});
		if(diaSemana=="5")
	$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"5": [seleccion]});
		if(diaSemana=="6")
	$("#day-schedule").data('artsy.dayScheduleSelector').deserialize({"6": [seleccion]});
	seleccion=[];
	}
}
</script>
<script>
function guardarLaHora()
{
if(guardarHora==0)
{
guardarHora=1;
console.log("ajuste de horarios activado");
return
}

else if(guardarHora==1)
{
guardarHora=0;
console.log("ajuste de horarios des activado");
return
}
}
</script>
</body>

</html>
